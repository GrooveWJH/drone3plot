{% extends "layouts/base.html" %}

{% block content %}
<div class="dashboard-wrapper">
  <section class="card config-card">
    <div class="config-header">
      <h3>系统配置</h3>
    </div>
    <form class="config-form is-open" data-config-form>
      <div class="config-grid">
        <label>网关序列号
          <input type="text" name="DJI_GATEWAY_SN" value="{{ config_values.DJI_GATEWAY_SN }}" />
        </label>
        <label>MQTT Host
          <input type="text" name="DJI_MQTT_HOST" value="{{ config_values.DJI_MQTT_HOST }}" />
        </label>
        <label>MQTT Port
          <input type="number" name="DJI_MQTT_PORT" value="{{ config_values.DJI_MQTT_PORT }}" />
        </label>
        <label>MQTT 用户名
          <input type="text" name="DJI_MQTT_USERNAME" value="{{ config_values.DJI_MQTT_USERNAME }}" />
        </label>
        <label>MQTT 密码
          <input type="password" name="DJI_MQTT_PASSWORD" value="{{ config_values.DJI_MQTT_PASSWORD }}" />
        </label>
      </div>
    </form>
  </section>

  <section class="control-panels">
    <article class="card control-card">
      <div class="card-header">
        <h3>云端控制</h3>
        <span class="status-pill" data-auth-pill data-auth-pill-text>未连接</span>
      </div>
      <div class="stat-row">
        <div class="stat-item">
          <span class="label">电量</span>
          <div class="battery-stack">
            <span class="value" data-battery-status>--</span>
            <div class="battery-meter" aria-hidden="true">
              <div class="battery-fill" data-battery-fill></div>
            </div>
          </div>
        </div>
      </div>
      <div class="pose-strip">
        <div class="pose-item">
          <span class="label">X</span>
          <span class="value" data-pose-x>--</span>
        </div>
        <div class="pose-item">
          <span class="label">Y</span>
          <span class="value" data-pose-y>--</span>
        </div>
        <div class="pose-item">
          <span class="label">Z / RH</span>
          <span class="value"><span data-pose-z>--</span> / <span data-relative-height>--</span></span>
        </div>
        <div class="pose-item">
          <span class="label">YAW</span>
          <span class="value" data-pose-yaw>--</span>
        </div>
        <div class="pose-item">
          <span class="label">模式</span>
          <span class="value" data-flight-mode>--</span>
        </div>
      </div>
      <div class="feedback" data-auth-feedback></div>
      <div class="action-row">
        <button class="action-button primary with-icon" type="button" data-auth-request>
          连接并请求控制权
        </button>
        <button class="action-button primary with-icon" type="button" data-trajectory-start>
          <span class="material-symbols-outlined" aria-hidden="true">rocket_launch</span>
          开始执行任务
        </button>
        <button class="action-button ghost with-icon" type="button" data-photo-take>

          拍照
        </button>
      </div>
    </article>

    <article class="card control-card" data-live-card>
      <div class="card-header">
        <h3>直播</h3>
        <span class="status-pill" data-live-pill data-live-pill-text>未开启</span>
      </div>
      <label class="mini-label live-field">推流 URL (RTMP)
        <input type="text" data-live-rtmp value="rtmp://127.0.0.1/live/Drone001" placeholder="rtmp://..." />
      </label>
      <label class="mini-label live-field">播放 URL (HLS/MP4)
        <input type="text" data-live-playback value="http://127.0.0.1:8888/live/Drone001/index.m3u8" />
      </label>
      <div class="live-quality" data-live-quality>
        <span class="mini-label">画质</span>
        <div class="quality-options">
          <label class="quality-pill">
            <input type="radio" name="live_quality" value="0" checked />
            <span>自动</span>
          </label>
          <label class="quality-pill">
            <input type="radio" name="live_quality" value="1" />
            <span>流畅</span>
          </label>
          <label class="quality-pill">
            <input type="radio" name="live_quality" value="2" />
            <span>标清</span>
          </label>
          <label class="quality-pill">
            <input type="radio" name="live_quality" value="3" />
            <span>高清</span>
          </label>
          <label class="quality-pill">
            <input type="radio" name="live_quality" value="4" />
            <span>超清</span>
          </label>
        </div>
      </div>
      <div class="feedback" data-live-feedback></div>
      <div class="action-row">
        <button class="action-button primary with-icon" type="button" data-live-start>
          开启直播
        </button>
        <button class="action-button ghost with-icon" type="button" data-live-stop>
          <span class="material-symbols-outlined" aria-hidden="true">stop_circle</span>
          关闭直播
        </button>
      </div>
    </article>

  </section>

  <section class="live-stage" data-live-stage>
    <div class="live-video-wrapper">
      <div class="live-video-header">
        <span class="live-label">LIVE</span>
        <span class="live-meta" data-live-resolution>--</span>
      </div>
      <video data-live-video muted autoplay playsinline></video>
    </div>
  </section>

  <div class="auth-modal" data-auth-modal aria-hidden="true">
    <div class="auth-modal-content">
      <h4>允许云端控制</h4>
      <p class="mini-label">请在遥控器上点击允许</p>
      <p class="mini-label" data-auth-modal-status>等待用户确认…</p>
      <div class="auth-modal-actions">
        <button class="button-primary with-icon" type="button" data-auth-confirm>
          <span class="material-symbols-outlined" aria-hidden="true">check_circle</span>
          已允许，进入 DRC
        </button>
      </div>
    </div>
  </div>
</div>
{% endblock %}
